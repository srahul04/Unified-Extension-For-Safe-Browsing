<!DOCTYPE html>
<html>

<head>
    <title>Test Text Report Generation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }

        button {
            background: #667eea;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background: #5568d3;
        }

        #output {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <h1>Test Text Report Generation</h1>
    <p>Click the button below to test the text report generation functionality:</p>
    <button onclick="testReportGeneration()">Generate Test Report</button>
    <div id="output"></div>

    <script>
        // Mock scan results
        const scanResults = {
            url: 'https://example.com',
            timestamp: new Date().toISOString(),
            checks: [
                {
                    category: 'HTTPS & SSL',
                    severity: 'success',
                    details: '✓ Connection is secure (HTTPS).'
                },
                {
                    category: 'Security Headers',
                    severity: 'warning',
                    details: 'Missing 3 security headers: X-Frame-Options, X-Content-Type-Options, Strict-Transport-Security'
                },
                {
                    category: 'Cookie Security',
                    severity: 'success',
                    details: '5 cookies found. 0 insecure (100% secure)'
                }
            ],
            scores: {
                overall: 85,
                security: 80,
                privacy: 90
            }
        };

        function getGrade(score) {
            if (score >= 90) return 'A';
            if (score >= 80) return 'B';
            if (score >= 70) return 'C';
            if (score >= 60) return 'D';
            return 'F';
        }

        function generateSuggestions(check) {
            if (check.severity === 'success') return '';

            const suggestions = {
                'Security Headers': 'Contact the website administrator to configure proper security headers.',
                'Cookie Security': 'Clear insecure cookies or use incognito mode.'
            };

            return suggestions[check.category] || 'Review security settings.';
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function testReportGeneration() {
            try {
                // Build text report
                let report = '';
                report += '═══════════════════════════════════════════════════════════\n';
                report += '           WEBSITE SECURITY SCAN REPORT\n';
                report += '═══════════════════════════════════════════════════════════\n\n';

                // Metadata
                report += `URL: ${scanResults.url}\n`;
                report += `Date: ${new Date(scanResults.timestamp).toLocaleString()}\n`;
                report += `Generated by: Website Security Scanner Extension\n\n`;

                // Scores
                report += '───────────────────────────────────────────────────────────\n';
                report += '                  SECURITY ASSESSMENT\n';
                report += '───────────────────────────────────────────────────────────\n\n';
                report += `Overall Score:  ${scanResults.scores.overall}/100 (Grade: ${getGrade(scanResults.scores.overall)})\n`;
                report += `Security Score: ${scanResults.scores.security}/100 (Grade: ${getGrade(scanResults.scores.security)})\n`;
                report += `Privacy Score:  ${scanResults.scores.privacy}/100 (Grade: ${getGrade(scanResults.scores.privacy)})\n\n`;

                // Detailed Results
                report += '───────────────────────────────────────────────────────────\n';
                report += '                   DETAILED RESULTS\n';
                report += '───────────────────────────────────────────────────────────\n\n';

                scanResults.checks.forEach((check, index) => {
                    report += `${index + 1}. ${check.category}\n`;
                    report += `   Status: ${check.severity.toUpperCase()}\n`;
                    report += `   Details: ${check.details}\n`;

                    const suggestion = generateSuggestions(check);
                    if (suggestion) {
                        report += `   Recommendation: ${suggestion}\n`;
                    }
                    report += '\n';
                });

                // Footer
                report += '═══════════════════════════════════════════════════════════\n';
                report += '                    END OF REPORT\n';
                report += '═══════════════════════════════════════════════════════════\n';

                // Show preview
                document.getElementById('output').textContent = report;

                // Generate filename with timestamp
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
                const filename = `security-report-${timestamp}.txt`;

                // Download the text file
                downloadFile(report, filename, 'text/plain');

                alert('✓ Report generated successfully! Check your downloads folder.');

            } catch (error) {
                console.error('Report generation error:', error);
                alert(`Failed to generate report: ${error.message}`);
            }
        }
    </script>
</body>

</html>